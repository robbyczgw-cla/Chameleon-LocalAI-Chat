# ===================================
# Chameleon Chat - Docker Compose
# ===================================
# Usage: docker-compose up -d
# Stop:  docker-compose down
# Logs:  docker-compose logs -f

version: '3.8'

services:
  chameleon:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: chameleon-chat
    restart: unless-stopped
    ports:
      - "3000:3000"
    volumes:
      # Persist SQLite database
      - chameleon-data:/app/data
    environment:
      - NODE_ENV=production
      # Optional: Pre-configure API keys
      # - NEXT_PUBLIC_OPENROUTER_API_KEY=${OPENROUTER_API_KEY}
      # - NEXT_PUBLIC_TAVILY_API_KEY=${TAVILY_API_KEY}
    healthcheck:
      test: ["CMD", "wget", "-q", "--spider", "http://localhost:3000"]
      interval: 30s
      timeout: 10s
      retries: 3

volumes:
  chameleon-data:
    driver: local

# ===================================
# Usage Examples
# ===================================
#
# Start in background:
#   docker-compose up -d
#
# View logs:
#   docker-compose logs -f chameleon
#
# Stop:
#   docker-compose down
#
# Rebuild after updates:
#   docker-compose build --no-cache
#   docker-compose up -d
#
# Backup database:
#   docker cp chameleon-chat:/app/data/chameleon.db ./backup.db
#
# With LM Studio (on host machine):
#   LM Studio runs on host at localhost:1234
#   Container can access via host.docker.internal:1234
